<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <!-- start custom head snippets -->

    <!-- insert favicons. use https://realfavicongenerator.net/ -->

    <!-- Github Button
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script> -->

    <!--<![endif]-->
    <!-- end custom head snippets -->

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"
    ></script>
    <script src="/assets/js/typewrite.min.js"></script>

    <meta charset="utf-8" />

    <!-- begin _includes/seo.html -->
    <title>Machine Learning on Apple stock daily return2 - Hunâ€™s Blog</title>
    <meta
      name="description"
      content="import numpy as np import pandas as pd import os import matplotlib.pyplot as plt %matplotlib inline import seaborn as sns"
    />

    <meta name="author" content="Younghun Lee" />

    <meta property="article:author" content="Younghun Lee" />

    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Hun's Blog" />
    <meta
      property="og:title"
      content="Machine Learning on Apple stock daily return2"
    />
    <meta property="og:url" content="https://leeway00.github.io/ibm/proj2/" />

    <meta
      property="og:description"
      content="import numpy as np import pandas as pd import os import matplotlib.pyplot as plt %matplotlib inline import seaborn as sns"
    />

    <meta
      property="article:published_time"
      content="2022-05-21T00:00:00+00:00"
    />

    <meta
      property="article:modified_time"
      content="2022-08-17T02:08:25+00:00"
    />

    <link rel="canonical" href="https://leeway00.github.io/ibm/proj2/" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",

        "@type": "Person",
        "name": "Younghun Lee",
        "url": "https://leeway00.github.io/"
      }
    </script>

    <!-- end _includes/seo.html -->

    <link
      href="/feed.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Hun's Blog Feed"
    />

    <!-- https://t.co/dKP3o1e -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script>
      document.documentElement.className =
        document.documentElement.className.replace(/\bno-js\b/g, "") + " js ";
    </script>

    <!-- For all browsers -->
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link
      rel="preload"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"
    /></noscript>
  </head>

  <body class="layout--single_v2">
    <nav class="skip-links">
      <ul>
        <li>
          <a href="#site-nav" class="screen-reader-shortcut"
            >Skip to primary navigation</a
          >
        </li>
        <li>
          <a href="#main" class="screen-reader-shortcut">Skip to content</a>
        </li>
        <li>
          <a href="#footer" class="screen-reader-shortcut">Skip to footer</a>
        </li>
      </ul>
    </nav>

    <!--[if lt IE 9]>
      <div class="notice--danger align-center" style="margin: 0">
        You are using an <strong>outdated</strong> browser. Please
        <a href="https://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </div>
    <![endif]-->

    <div class="masthead">
      <div class="masthead__inner-wrap">
        <div class="masthead__menu">
          <nav id="site-nav" class="greedy-nav">
            <a class="site-title" href="/"> Hun's Blog </a>
            <ul class="visible-links">
              <li class="masthead__menu-item">
                <a href="/categories/projects/">Project Notes</a>
              </li>
              <li class="masthead__menu-item">
                <a href="/categories/ibm-machine-learning/">IBM Notes</a>
              </li>
              <li class="masthead__menu-item">
                <a href="/categories/time-series/">Time Series</a>
              </li>
              <li class="masthead__menu-item"></li>
            </ul>

            <button class="greedy-nav__toggle hidden" type="button">
              <span class="visually-hidden">Toggle menu</span>
              <div class="navicon"></div>
            </button>
            <ul class="hidden-links hidden"></ul>
          </nav>
        </div>
      </div>
    </div>

    <!-- <script>
    var elements = document.querySelectorAll('.page__content.e-content').childNodes; // ìˆ˜ì •1 
    var addContent = false;
    var contentsToAdd = [];
    var expandtags = null;
    var detailText = null;
    var detailsTag = null;
    var summaryTag = null;
    var detailsContent = null;
    for (var i=elements.length - 1; i > -1; i--){
        el = elements[i]
        if (el.innerHTML == '[/expand]'){
            addContent = true
            detailsContent = document.createElement('div')
            detailsContent.className = 'collaspe-content'
            detailsContent.setAttribute('markdown', '1')
            el.parentNode.removeChild(el)
        } else if (el.innerHTML == '[expand]' || (el.nodeName == 'P' && el.innerHTML.includes('[expand]summary:'))) {
            addContent = false
            expandtags = el.innerHTML.split('summary:')
            if (expandtags.length == 1){
                detailText = 'Details'
            } else {
                detailText = expandtags[1]
            }
            detailsTag = document.createElement('details')
            detailsTag.className = 'collaspe-article'
            summaryTag = document.createElement('summary')
            summaryTag.appendChild(document.createTextNode(detailText))
            detailsTag.appendChild(summaryTag)
            for (var j=contentsToAdd.length - 1; j > -1; j--) {
                detailsContent.appendChild(contentsToAdd[j])
            }
            detailsTag.appendChild(detailsContent)
            el.parentNode.replaceChild(detailsTag, el)
            contentsToAdd = []
        } else {
            if (addContent) {
                contentsToAdd.push(el)
            }
        }
    }
</script> -->

    <div class="initial-content">
      <!-- 
  Changed
  1. Moved tag, categories (page__meta) under the title (page__inner-wrap).
  2. 
-->

      <div id="main" role="main">
        <div class="sidebar sticky">
          <div itemscope itemtype="https://schema.org/Person" class="h-card">
            <div class="author__avatar">
              <a href="https://leeway00.github.io/">
                <img
                  src="/assets/images/profile_yh.png"
                  alt="Younghun Lee"
                  itemprop="image"
                  class="u-photo"
                />
              </a>
            </div>

            <div class="author__content">
              <h3 class="author__name p-name" itemprop="name">
                <a
                  class="u-url"
                  rel="me"
                  href="https://leeway00.github.io/"
                  itemprop="url"
                  >Younghun Lee</a
                >
              </h3>

              <div class="author__bio p-note" itemprop="description">
                <p>Student</p>
              </div>
            </div>

            <div class="author__urls-wrapper">
              <button class="btn btn--inverse">Follow</button>
              <ul class="author__urls social-icons">
                <li
                  itemprop="homeLocation"
                  itemscope
                  itemtype="https://schema.org/Place"
                >
                  <a
                    ><i
                      class="fas fa-fw fa-map-marker-alt"
                      aria-hidden="true"
                    ></i>
                    <span itemprop="name" class="p-locality">Somewhere</span></a
                  >
                </li>

                <li>
                  <a
                    href="mailto:leeyh0920@gmail.com"
                    rel="nofollow noopener noreferrer me"
                    ><i
                      class="fas fa-fw fa-envelope-square"
                      aria-hidden="true"
                    ></i
                    ><span class="label">Personal Email</span></a
                  >
                </li>

                <li>
                  <a
                    href="https://leeway00@github.com/"
                    rel="nofollow noopener noreferrer me"
                    ><i class="fab fa-fw fa-github" aria-hidden="true"></i
                    ><span class="label">GitHub</span></a
                  >
                </li>

                <li>
                  <a
                    href="https://linkedin.com/in/younghunlee"
                    rel="nofollow noopener noreferrer me"
                    ><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i
                    ><span class="label">linkedin</span></a
                  >
                </li>

                <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
              </ul>
            </div>
          </div>

          <nav class="nav__list">
            <input id="ac-toc" name="accordion-toc" type="checkbox" />
            <label for="ac-toc">Toggle menu</label>
            <ul class="nav__items"></ul>
          </nav>

          <!--ì „ì²´ ê¸€ ìˆ˜ë¥¼ ì„¸ê¸° ìœ„í•œ ì—°ì‚°. sum ë³€ìˆ˜ì— ì „ì²´ ê¸€ ìˆ˜ ì €ìž¥-->

          <nav class="nav__list">
            <input id="ac-toc" name="accordion-toc" type="checkbox" />
            <label for="ac-toc">Toggle menu</label>
            <ul class="nav__items" id="category_tag_menu">
              <!--ì „ì²´ ê¸€ ìˆ˜-->
              <li>
                ðŸ“‚
                <span style="font-family: 'Cafe24Oneprettynight'"
                  >Total Posts #</span
                >
                <span style="font-family: 'Coming Soon'">23</span>
                <span style="font-family: 'Cafe24Oneprettynight'"></span>
              </li>
              <li>
                <!--span íƒœê·¸ë¡œ ì¹´í…Œê³ ë¦¬ë“¤ì„ í¬ê²Œ ë¶„ë¥˜ ex) C/C++-->
                <span class="nav__sub-title">Machine Learning</span>
                <!--ul íƒœê·¸ë¡œ ê°™ì€ ì¹´í…Œê³ ë¦¬ë“¤ ëª¨ì•„ë‘” íŽ˜ì´ì§€ë“¤ ë‚˜ì—´-->
                <ul>
                  <!--Cpp ì¹´í…Œê³ ë¦¬ ê¸€ë“¤ì„ ëª¨ì•„ë‘” íŽ˜ì´ì§€ì¸ /categories/cpp ì£¼ì†Œì˜ ê¸€ë¡œ ë§í¬ ì—°ê²°-->
                  <!--category[1].size ë¡œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¥¼ ê°€ì§„ ê¸€ì˜ ê°œìˆ˜ í‘œì‹œ-->

                  <li>
                    <a href="/categories/ibm-machine-learning" class=""
                      >IBM (16)</a
                    >
                  </li>
                </ul>
                <!--ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul-->
                <span class="nav__sub-title">Statistics</span>
                <ul>
                  <li>
                    <a href="/categories/time-series" class=""
                      >Time Series (1)</a
                    >
                  </li>
                </ul>
                <span class="nav__sub-title">Projects</span>
                <ul>
                  <li>
                    <a href="/categories/projects" class="">Time Series (2)</a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>

        <article
          class="page h-entry"
          itemscope
          itemtype="https://schema.org/CreativeWork"
        >
          <meta
            itemprop="headline"
            content="Machine Learning on Apple stock daily return2"
          />
          <meta
            itemprop="description"
            content="import numpy as npimport pandas as pdimport osimport matplotlib.pyplot as plt%matplotlib inlineimport seaborn as sns"
          />
          <meta itemprop="datePublished" content="2022-05-21T00:00:00+00:00" />
          <meta itemprop="dateModified" content="2022-08-17T02:08:25+00:00" />

          <div class="page__inner-wrap">
            <header>
              <h1
                id="page-title"
                class="page__title p-name"
                itemprop="headline"
              >
                <a
                  href="https://leeway00.github.io/ibm/proj2/"
                  class="u-url"
                  itemprop="url"
                  >Machine Learning on Apple stock daily return2
                </a>
              </h1>
            </header>

            <header class="page__meta">
              <small>
                <p class="page__taxonomy">
                  <strong>
                    <i class="fas fa-fw fa-tags" aria-hidden="true"></i>
                    Tags:
                  </strong>
                  <span itemprop="keywords">
                    <a
                      href="/tags/ibm"
                      class="page__taxonomy-item p-category"
                      rel="tag"
                      >IBM</a
                    ><span class="sep">, </span>

                    <a
                      href="/tags/machine-learning"
                      class="page__taxonomy-item p-category"
                      rel="tag"
                      >Machine Learning</a
                    >
                  </span>
                </p>

                <p class="page__taxonomy">
                  <strong>
                    <i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>
                    Categories:
                  </strong>
                  <span itemprop="keywords">
                    <a
                      href="/categories/projects"
                      class="page__taxonomy-item p-category"
                      rel="tag"
                      >Projects</a
                    >
                  </span>
                </p>

                <p class="page__date">
                  <strong
                    ><i
                      class="fas fa-fw fa-calendar-alt"
                      aria-hidden="true"
                    ></i>
                    Updated:</strong
                  >
                  <time class="dt-published" datetime="2022-08-17"
                    >August 17, 2022</time
                  >
                </p>
              </small>
              <hr />
            </header>

            <section class="page__content e-content" itemprop="text">
              <aside class="sidebar__right sticky">
                <nav class="toc">
                  <header>
                    <h4 class="nav__title">
                      <i class="fas fa-file-alt"></i> On this page
                    </h4>
                  </header>
                  <ul class="toc__menu">
                    <li>
                      <a href="#1-data">1. Data</a>
                      <ul>
                        <li>
                          <a href="#1-1-determining-normality"
                            >1-1 Determining Normality</a
                          >
                          <ul>
                            <li>
                              <a href="#boxcox-transformation"
                                >BoxCox Transformation</a
                              >
                            </li>
                            <li>
                              <a href="#using-dummy-variables"
                                >Using dummy variables</a
                              >
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="#2-sklearn-learing-model"
                        >2. Sklearn learing model</a
                      >
                      <ul>
                        <li>
                          <a href="#testing-learning-model"
                            >Testing learning model</a
                          >
                        </li>
                        <li><a href="#learning-model">Learning Model</a></li>
                      </ul>
                    </li>
                    <li>
                      <a href="#3-classification">3. Classification</a>
                      <ul>
                        <li>
                          <a href="#3-1-basic-classification-models"
                            >3-1 Basic classification models</a
                          >
                          <ul>
                            <li>
                              <a href="#3-1-1-logistic-regression"
                                >3-1-1 Logistic Regression</a
                              >
                            </li>
                            <li>
                              <a href="#3-1-2-tree-based-modelm"
                                >3-1-2 Tree based modelm</a
                              >
                            </li>
                            <li><a href="#3-1-3-knn">3-1-3 KNN</a></li>
                          </ul>
                        </li>
                        <li>
                          <a href="#3-2-linear-decision-boundary"
                            >3-2 Linear Decision boundary</a
                          >
                          <ul>
                            <li><a href="#classifcation">Classifcation</a></li>
                          </ul>
                        </li>
                        <li>
                          <a href="#3-3-classification-ensamble"
                            >3-3 Classification Ensamble</a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="#4-unsupervised">4. Unsupervised</a>
                      <ul>
                        <li>
                          <a href="#4-1-k-means-clustering"
                            >4-1 K-means clustering</a
                          >
                        </li>
                        <li>
                          <a href="#4-2-comparing-in-multidimension"
                            >4-2 Comparing in multidimension</a
                          >
                        </li>
                        <li>
                          <a href="#4-3-utilizing-in-regression"
                            >4-3 utilizing in regression</a
                          >
                        </li>
                        <li><a href="#4-4-pca">4-4 PCA</a></li>
                      </ul>
                    </li>
                    <li><a href="#etc">ETC</a></li>
                  </ul>
                </nav>
              </aside>
              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
</code></pre>
                </div>
              </div>

              <h2 id="1-data">1. Data</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">aapl</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'./data/aapl.csv'</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">aapl</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'Date'</span><span class="p">,</span><span class="s">'daily_ret'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">aapl</span><span class="p">[</span><span class="s">'daily_ret'</span><span class="p">]</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">aapl</span><span class="p">.</span><span class="n">columns</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Index(['Date', 'Close', 'Volume', 'Lo', 'HO', 'CO', 'support_low',
       'support_open', 'support_high', 'std20', 'std120', 'std_open20',
       'std_high20', 'std_intra', 'ma20', 'ma120', 'daily_ret', 'd_mom',
       '3d_mom', '5d_mom', '20d_mom', '252d_mom', 'AAPL_factor2',
       'AAPL_factor1', 'change_wti', 'Lo_wti', 'HO_wti', 'CO_wti',
       'change_nasdaq', 'Lo_nasdaq', 'HO_nasdaq', 'CO_nasdaq',
       'Close_bond_10y', 'high6m_bond_10y', 'Close_bond_2y', 'high6m_bond_2y',
       'change_itw', 'Lo_itw', 'HO_itw', 'CO_itw', 'Close_bond_1m',
       'high6m_bond_1m', 'Close_bond_1y', 'high6m_bond_1y', 'Close_vix',
       'change_vix', 'Lo_vix', 'HO_vix', 'CO_vix', 'high6m_vix', 'high1y_vix',
       'Close_sp500', 'change_sp500', 'Lo_sp500', 'HO_sp500', 'CO_sp500',
       'high6m_sp500', 'high1y_sp500', 'y', 'm', 'd', 'vix_cat',
       'vix_change_cat', 'sp500_cat', 'sp500_change_cat'],
      dtype='object')
</code></pre>
                </div>
              </div>

              <h3 id="1-1-determining-normality">1-1 Determining Normality</h3>

              <h4 id="boxcox-transformation">BoxCox Transformation</h4>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## from scipy.stats.mstats import normaltest ## D'Agostino K^2 Test
## from scipy.stats import boxcox ## Not doing this since it's time series data and not normally distributed
</span>
<span class="c1">## ## Adding boxcox value
## aapl_cut = aapl.drop(['Date','daily_ret'], axis=1)
## nomres = normaltest(aapl_cut)
## aapl_cut = aapl_cut.iloc[:,np.where(nomres[0] &gt; 0.05)[0].tolist()]
## for i in aapl_cut.columns:
##     bc_res = boxcox(aapl_cut[i])
##     aapl['box_'+i] = bc_res[0]
</span></code></pre>
                </div>
              </div>

              <h4 id="using-dummy-variables">Using dummy variables</h4>
              <p>Making dummy variable based on categorized data</p>
              <ul>
                <li>vix, vix change</li>
                <li>sp500, sp500 change</li>
              </ul>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">opt</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">if</span> <span class="n">opt</span><span class="p">:</span>
    <span class="n">one_hot_encode_cols</span> <span class="o">=</span> <span class="n">aapl</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">aapl</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="n">aapl</span><span class="p">.</span><span class="n">vix_cat</span><span class="p">.</span><span class="n">dtype</span><span class="p">]</span>  <span class="c1">## filtering by string categoricals
</span>    <span class="n">one_hot_encode_cols</span> <span class="o">=</span> <span class="n">one_hot_encode_cols</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1">## list of categorical fields
</span>
    <span class="c1">## Do the one hot encoding
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">aapl</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">one_hot_encode_cols</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1">## ## Combination of dummy variables: Not useful since it takes a lot of computing power
</span>    <span class="c1">## pd.options.mode.chained_assignment = None
</span>    <span class="c1">## temp = pd.DataFrame()
</span>    <span class="c1">## for i in [one_hot_encode_cols[0],one_hot_encode_cols[2]]:
</span>    <span class="c1">##     lists = df.columns[1:]
</span>    <span class="c1">##     for name in lists:
</span>    <span class="c1">##         if name in "daily_ret":
</span>    <span class="c1">##             continue
</span>    <span class="c1">##         if name[:-2] not in one_hot_encode_cols:
</span>    <span class="c1">##             for j in range(2,5):
</span>    <span class="c1">##                 temp[name+'*'+i+'_'+str(j)] = df[name]*df[i+'_'+str(j)]
</span>    <span class="c1">## df = pd.concat([df, temp], axis=1)
</span><span class="k">else</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">aapl</span>
    
<span class="k">def</span> <span class="nf">singular_test</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">dc</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">corr</span><span class="p">()</span>
    <span class="n">non</span> <span class="o">=</span> <span class="p">(</span><span class="n">dc</span> <span class="o">==</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">!=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">dc</span><span class="p">[</span><span class="n">non</span><span class="p">].</span><span class="n">T</span><span class="p">[</span><span class="n">non</span><span class="p">]</span>

<span class="n">singular_test</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div>
                <style scoped="">
                  .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                  }

                  .dataframe tbody tr th {
                    vertical-align: top;
                  }

                  .dataframe thead th {
                    text-align: right;
                  }
                </style>
                <table border="1" class="dataframe">
                  <thead>
                    <tr style="text-align: right">
                      <th></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <h2 id="2-sklearn-learing-model">2. Sklearn learing model</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> \
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">TimeSeriesSplit</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> \
    <span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
</code></pre>
                </div>
              </div>

              <h3 id="testing-learning-model">Testing learning model</h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> 
             <span class="n">scoring</span> <span class="o">=</span> <span class="p">[</span><span class="s">'r2'</span><span class="p">,</span> <span class="s">'neg_mean_squared_error'</span><span class="p">],</span>
             <span class="n">validate</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">scoring</span> <span class="o">=</span> <span class="p">[</span><span class="s">'r2'</span><span class="p">,</span> <span class="s">'neg_mean_squared_error'</span><span class="p">]</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cv_results</span>

<span class="k">def</span> <span class="nf">regress_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">regressor</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">target</span> <span class="o">=</span><span class="s">'daily_ret'</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">pred_window</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
    <span class="c1">## training with 6month(120days) and predict 3month(60days)
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="n">target</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
    <span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">()</span> <span class="c1">## n_splits=_num_batch
</span>
    <span class="n">pf</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>

        <span class="n">estimator</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s">'scaler'</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s">"polynomial_features"</span><span class="p">,</span> <span class="n">pf</span><span class="p">),</span>
            <span class="p">(</span><span class="s">"ridge_regression"</span><span class="p">,</span> <span class="n">ridge</span><span class="p">)])</span>

        <span class="n">r2</span><span class="p">,</span> <span class="n">mse</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">tscv</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>

<span class="c1">## regress_test(df, Ridge())
</span></code></pre>
                </div>
              </div>

              <h3 id="learning-model">Learning Model</h3>

              <p>What is the problem here?</p>
              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">def</span> <span class="nf">Xy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cls</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="n">target</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="n">target</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">execute_CV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">poly</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">gridsearch</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">poly</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># when both polynomial features and parameter grid are used
</span>        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">poly_able</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s">'uint8'</span><span class="p">).</span><span class="n">values</span>
        <span class="n">X_poly</span><span class="p">,</span> <span class="n">X_non</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">poly_able</span><span class="p">],</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">poly_able</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
            <span class="n">X2</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">i</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_poly</span><span class="p">)</span>
            <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X2</span><span class="p">,</span> <span class="n">X_non</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gridsearch</span><span class="p">:</span>
                <span class="n">CV_</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CV_</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">CV_</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">CV_</span><span class="p">.</span><span class="n">best_score_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">CV_</span><span class="p">)</span>
            
        <span class="n">mxx</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">mxx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">mxx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">## When only parameter grid are used
</span>        <span class="k">if</span> <span class="n">gridsearch</span><span class="p">:</span>
            <span class="n">CV_</span> <span class="o">=</span>  <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CV_</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">CV_</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Best score:'</span><span class="p">,</span> <span class="n">CV_</span><span class="p">.</span><span class="n">best_score_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CV_</span>

<span class="k">def</span> <span class="nf">class_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Accuracy:'</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'F1:'</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    


<span class="k">def</span> <span class="nf">measure_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">train</span> <span class="o">=</span>  <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">({</span><span class="s">'accuracy'</span><span class="p">:</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">),</span>
                      <span class="s">'precision'</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">),</span>
                      <span class="s">'recall'</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">),</span>
                      <span class="s">'f1'</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)},</span>
                      <span class="n">name</span><span class="o">=</span><span class="s">'train'</span><span class="p">)</span>
    
    <span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">({</span><span class="s">'accuracy'</span><span class="p">:</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">),</span>
                    <span class="s">'precision'</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">),</span>
                    <span class="s">'recall'</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">),</span>
                    <span class="s">'f1'</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">)},</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">'test'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">colorsetup</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">palette</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="p">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">confusion_plot</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">sns</span><span class="p">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">sns</span><span class="p">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                     <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'d'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> 
                     <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s">"size"</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">:</span> <span class="s">"bold"</span><span class="p">})</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'False'</span><span class="p">,</span> <span class="s">'True'</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">);</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'True value'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">);</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Prediction'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="k">def</span> <span class="nf">learning</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">regressor</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">clss</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
            <span class="n">n_jobs</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">poly</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Date</span> <span class="o">=</span> <span class="s">'Date'</span><span class="p">,</span> <span class="n">gridsearch</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">target</span> <span class="o">=</span><span class="s">'daily_ret'</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="n">pred_window</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">prnt</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">refit</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

    <span class="c1">## training with 6month(120days) and predict 3month(60days)
</span>    <span class="k">if</span> <span class="n">pred</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">data_pred</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Xy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">clss</span><span class="p">)</span>

    <span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">()</span> <span class="c1">#n_splits=int(data.shape[0]), max_train_size=window
</span>    
    <span class="k">if</span> <span class="n">params</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cvres</span> <span class="o">=</span>  <span class="n">execute_CV</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tscv</span><span class="p">,</span> <span class="n">poly</span> <span class="o">=</span> <span class="n">poly</span><span class="p">,</span> <span class="n">gridsearch</span> <span class="o">=</span> <span class="n">gridsearch</span><span class="p">,</span>
                                <span class="n">scoring</span><span class="o">=</span> <span class="n">scores</span><span class="p">,</span> <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">refit</span> <span class="o">=</span> <span class="n">refit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pred</span><span class="p">:</span>
            <span class="n">X_pred</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">Xy</span><span class="p">(</span><span class="n">data_pred</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">clss</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prnt</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">clss</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">cvres</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">confusion_plot</span><span class="p">(</span><span class="n">y_pred</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">cvres</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rpt</span> <span class="o">=</span> <span class="n">class_report</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">cvres</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">cvres</span><span class="p">,</span> <span class="n">rpt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cvres</span><span class="p">,</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">## cross validation only with polynomial features
</span>        <span class="k">if</span> <span class="n">poly</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">poly_able</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s">'uint8'</span><span class="p">).</span><span class="n">values</span>
            <span class="n">X_poly</span><span class="p">,</span> <span class="n">X_non</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">poly_able</span><span class="p">],</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">poly_able</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
                <span class="n">X2</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">i</span><span class="p">).</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_poly</span><span class="p">)</span>
                <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X2</span><span class="p">,</span> <span class="n">X_non</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">tscv</span><span class="p">,</span>
                                            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_results</span>
                <span class="k">if</span> <span class="n">prnt</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">regressor</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">scores</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## no cross validation
</span>            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="n">regressor</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pred</span><span class="p">:</span>
                <span class="n">X_pred</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">Xy</span><span class="p">(</span><span class="n">data_pred</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">clss</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prnt</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">clss</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)))</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">confusion_plot</span><span class="p">(</span><span class="n">y_pred</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_report</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">confusion_plot</span><span class="p">(</span><span class="n">y_pred</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tscv</span><span class="p">,</span> <span class="n">clss</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">reg</span><span class="p">,</span> <span class="n">res</span>
</code></pre>
                </div>
              </div>

              <h2 id="3-classification">3. Classification</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
</code></pre>
                </div>
              </div>

              <h3 id="3-1-basic-classification-models">
                3-1 Basic classification models
              </h3>

              <h4 id="3-1-1-logistic-regression">3-1-1 Logistic Regression</h4>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">'liblinear'</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">penalty</span> <span class="o">=</span> <span class="s">'l1'</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'log__C'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">regressor</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s">"log"</span><span class="p">,</span> <span class="n">lr</span><span class="p">)])</span>

<span class="n">reg</span><span class="p">,</span> <span class="n">rpt</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">regressor</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span> \
    <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">cv_results_</span>
<span class="k">print</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">'param_log__C'</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s">'mean_test_score'</span><span class="p">])</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Fitting 5 folds for each of 5 candidates, totalling 25 fits
Best score: 0.5893805309734513
Accuracy: 0.6387665198237885
F1: 0.6796875
AxesSubplot(0.125,0.125;0.62x0.755)
{'log__C': 32.5}





[&lt;matplotlib.lines.Line2D at 0x2866f62e0&gt;]
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_38_2.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code><span class="n">reg</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>              precision    recall  f1-score   support

       False       0.56      0.81      0.66       108
        True       0.71      0.41      0.52       119

    accuracy                           0.60       227
   macro avg       0.63      0.61      0.59       227
weighted avg       0.64      0.60      0.59       227
</code></pre>
                </div>
              </div>

              <h4 id="3-1-2-tree-based-modelm">3-1-2 Tree based modelm</h4>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">export_graphviz</span>
<span class="kn">import</span> <span class="nn">pydotplus</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Estimate dtc model and report outcomes
</span><span class="n">dt1</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">dt1</span><span class="p">,</span> <span class="n">rpt</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">dt1</span><span class="p">,</span>
    <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">prnt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Estimate dtc model and report outcomes
</span><span class="n">dtc</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'max_depth'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dt1</span><span class="p">.</span><span class="n">tree_</span><span class="p">.</span><span class="n">max_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
              <span class="s">'max_features'</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt1</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>

<span class="n">reg</span><span class="p">,</span> <span class="n">rpt</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">dtc</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span>\
    <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_params_</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Fitting 5 folds for each of 639 candidates, totalling 3195 fits
Best score: 0.6466076696165193
AxesSubplot(0.125,0.125;0.62x0.755)
Accuracy: 0.6167400881057269
F1: 0.5538461538461539
{'max_depth': 3, 'max_features': 25}
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_43_1.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">reg</span><span class="p">.</span><span class="n">best_par</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">res</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">cv_results_</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">'param_max_depth'</span><span class="p">].</span><span class="n">data</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="s">'mean_test_score'</span><span class="p">])</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>[&lt;matplotlib.lines.Line2D at 0x176a475b0&gt;]
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_45_1.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">#### BEGIN SOLUTION
## Create an output destination for the file
</span><span class="n">dot_data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

<span class="n">export_graphviz</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="n">dot_data</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">pydotplus</span><span class="p">.</span><span class="n">graph_from_dot_data</span><span class="p">(</span><span class="n">dot_data</span><span class="p">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="c1">## View the tree image
</span><span class="n">filename</span> <span class="o">=</span> <span class="s">'wine_tree_prune.png'</span>
<span class="n">graph</span><span class="p">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span> 
<span class="c1">#### END SOLUTION
</span></code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_46_0.png"
                  alt="png"
                />
              </p>

              <h4 id="3-1-3-knn">3-1-3 KNN</h4>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Estimate KNN model and report outcomes
</span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'knn__n_neighbors'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s">'knn__weights'</span><span class="p">:</span> <span class="p">[</span><span class="s">'uniform'</span><span class="p">,</span> <span class="s">'distance'</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s">"knn"</span><span class="p">,</span> <span class="n">knn</span><span class="p">)])</span>

<span class="n">reg</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">model</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span>\
    <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">cv_results_</span>
<span class="k">print</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_params_</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Fitting 5 folds for each of 40 candidates, totalling 200 fits
Best score: 0.5386430678466076
              precision    recall  f1-score   support

       False       0.42      0.24      0.30       106
        True       0.51      0.71      0.60       121

    accuracy                           0.49       227
   macro avg       0.47      0.47      0.45       227
weighted avg       0.47      0.49      0.46       227

Accuracy: 0.4889867841409692
F1: 0.5972222222222222
AxesSubplot(0.125,0.125;0.62x0.755)
{'knn__n_neighbors': 145, 'knn__weights': 'uniform'}
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_48_1.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'daily_ret'</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">'daily_ret'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'daily_ret'</span><span class="p">,</span><span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s">'daily_ret'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>


<span class="n">max_k</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">f1_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">error_rates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="c1">## 1-accuracy
</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_k</span><span class="p">):</span>
    
    <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s">'distance'</span><span class="p">)</span>
    <span class="n">knn</span> <span class="o">=</span> <span class="n">knn</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="n">f1_scores</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="n">error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">error_rates</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
    
<span class="n">f1_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f1_scores</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'K'</span><span class="p">,</span> <span class="s">'F1 Score'</span><span class="p">])</span>
<span class="n">error_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">error_rates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'K'</span><span class="p">,</span> <span class="s">'Error Rate'</span><span class="p">])</span>

<span class="c1">## Plot F1 results
</span><span class="n">sns</span><span class="p">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">'talk'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">'ticks'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">f1_results</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'K'</span><span class="p">).</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'K'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">'F1 Score'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_k</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'KNN F1 Score'</span><span class="p">)</span>
<span class="c1">## plt.savefig('knn_f1.png')
</span></code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>Text(0.5, 1.0, 'KNN F1 Score')




&lt;Figure size 1800x1200 with 0 Axes&gt;
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_49_2.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Plot Accuracy (Error Rate) results
</span><span class="n">sns</span><span class="p">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">'talk'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">'ticks'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">error_results</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'K'</span><span class="p">).</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'K'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">'Error Rate'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_k</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'KNN Elbow Curve'</span><span class="p">)</span>


</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>Text(0.5, 1.0, 'KNN Elbow Curve')




&lt;Figure size 1800x1200 with 0 Axes&gt;
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_50_2.png"
                  alt="png"
                />
              </p>

              <h3 id="3-2-linear-decision-boundary">
                3-2 Linear Decision boundary
              </h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'daily_ret'</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'daily_ret'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
<span class="n">correlations</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">fields</span><span class="p">].</span><span class="n">corrwith</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">correlations</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">correlations</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">).</span><span class="n">sort_values</span><span class="p">().</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:].</span><span class="n">index</span>
<span class="n">X_sub</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span>

<span class="n">LSVC</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span>
<span class="n">LSVC</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sub</span><span class="p">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">X_color</span> <span class="o">=</span> <span class="n">X_sub</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">y_color</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_color</span><span class="p">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">y_color</span> <span class="o">=</span> <span class="n">y_color</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="s">'red'</span> <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">'yellow'</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">X_color</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_color</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="n">y_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## -----------
</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.005</span><span class="p">,</span> <span class="p">.</span><span class="mi">005</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.005</span><span class="p">,</span> <span class="p">.</span><span class="mi">005</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">)</span>
<span class="n">xx_ravel</span> <span class="o">=</span> <span class="n">xx</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">yy_ravel</span> <span class="o">=</span> <span class="n">yy</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">X_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">xx_ravel</span><span class="p">,</span> <span class="n">yy_ravel</span><span class="p">]).</span><span class="n">T</span>
<span class="n">y_grid_predictions</span> <span class="o">=</span> <span class="n">LSVC</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_grid</span><span class="p">)</span>
<span class="n">y_grid_predictions</span> <span class="o">=</span> <span class="n">y_grid_predictions</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">y_grid_predictions</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">autumn_r</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## -----------
</span><span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s">'decision boundary for LinearSVC'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_52_0.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="k">def</span> <span class="nf">plot_decision_boundary</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">estimator</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">X_color</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">y_color</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_color</span><span class="p">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">y_color</span> <span class="o">=</span> <span class="n">y_color</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="s">'red'</span> <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">'blue'</span><span class="p">)</span>
    <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="mi">005</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="mi">005</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">)</span>
    <span class="n">xx_ravel</span> <span class="o">=</span> <span class="n">xx</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">yy_ravel</span> <span class="o">=</span> <span class="n">yy</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">X_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">xx_ravel</span><span class="p">,</span> <span class="n">yy_ravel</span><span class="p">]).</span><span class="n">T</span>
    <span class="n">y_grid_predictions</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_grid</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">y_grid_predictions</span> <span class="o">=</span> <span class="n">y_grid_predictions</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">y_grid_predictions</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">autumn_r</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_color</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_color</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">y_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="p">))</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="n">gammas</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span>
    <span class="n">SVC_Gaussian</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'rbf'</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
    <span class="n">plot_decision_boundary</span><span class="p">(</span><span class="n">SVC_Gaussian</span><span class="p">,</span> <span class="n">X_sub</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_0.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_1.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_2.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_3.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_4.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_5.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_6.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_7.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_8.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_54_9.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">Cs</span> <span class="o">=</span> <span class="p">[.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">Cs</span><span class="p">:</span>
    <span class="n">SVC_Gaussian</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'rbf'</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
    <span class="n">plot_decision_boundary</span><span class="p">(</span><span class="n">SVC_Gaussian</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>/Users/hun/miniforge3/envs/hun/lib/python3.9/site-packages/sklearn/base.py:450: UserWarning: X does not have valid feature names, but SVC was fitted with feature names
  warnings.warn(
/Users/hun/miniforge3/envs/hun/lib/python3.9/site-packages/sklearn/base.py:450: UserWarning: X does not have valid feature names, but SVC was fitted with feature names
  warnings.warn(
/Users/hun/miniforge3/envs/hun/lib/python3.9/site-packages/sklearn/base.py:450: UserWarning: X does not have valid feature names, but SVC was fitted with feature names
  warnings.warn(
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_55_1.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_55_2.png"
                  alt="png"
                />
              </p>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_55_3.png"
                  alt="png"
                />
              </p>

              <h4 id="classifcation">Classifcation</h4>
              <ul>
                <li>SVC, nystroem converge time</li>
                <li>Tree model</li>
              </ul>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.kernel_approximation</span> <span class="kn">import</span> <span class="n">Nystroem</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'daily_ret'</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">'kernel'</span><span class="p">:</span> <span class="s">'rbf'</span><span class="p">}</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">nystroem</span> <span class="o">=</span> <span class="n">Nystroem</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SGDClassifier</span><span class="p">()</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">svc</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>158 ms Â± 894 Âµs per loop (mean Â± std. dev. of 7 runs, 10 loops each)
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">X_transformed</span> <span class="o">=</span> <span class="n">nystroem</span><span class="p">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">sgd</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>50.2 ms Â± 15.8 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">X2_transformed</span> <span class="o">=</span> <span class="n">nystroem</span><span class="p">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X2</span><span class="p">)</span>
<span class="n">sgd</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X2_transformed</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">train_test_full_error</span>
<span class="c1">#### END SOLUTION
</span></code></pre>
                </div>
              </div>

              <div>
                <style scoped="">
                  .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                  }

                  .dataframe tbody tr th {
                    vertical-align: top;
                  }

                  .dataframe thead th {
                    text-align: right;
                  }
                </style>
                <table border="1" class="dataframe">
                  <thead>
                    <tr style="text-align: right">
                      <th></th>
                      <th>train</th>
                      <th>test</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th>accuracy</th>
                      <td>1.0</td>
                      <td>0.513216</td>
                    </tr>
                    <tr>
                      <th>precision</th>
                      <td>1.0</td>
                      <td>0.522388</td>
                    </tr>
                    <tr>
                      <th>recall</th>
                      <td>1.0</td>
                      <td>0.600858</td>
                    </tr>
                    <tr>
                      <th>f1</th>
                      <td>1.0</td>
                      <td>0.558882</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s">'max_depth'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="p">.</span><span class="n">tree_</span><span class="p">.</span><span class="n">max_depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
              <span class="s">'max_features'</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>

<span class="n">GR</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
                  <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                  <span class="n">scoring</span><span class="o">=</span><span class="s">'recall'</span><span class="p">,</span>
                  <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">GR</span> <span class="o">=</span> <span class="n">GR</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">GR</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">.</span><span class="n">tree_</span><span class="p">.</span><span class="n">node_count</span><span class="p">,</span> <span class="n">GR</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">.</span><span class="n">tree_</span><span class="p">.</span><span class="n">max_depth</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>(3, 1)
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">y_train_pred_gr</span> <span class="o">=</span> <span class="n">GR</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_test_pred_gr</span> <span class="o">=</span> <span class="n">GR</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">train_test_gr_error</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">measure_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred_gr</span><span class="p">,</span> <span class="s">'train'</span><span class="p">),</span>
                                 <span class="n">measure_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_gr</span><span class="p">,</span> <span class="s">'test'</span><span class="p">)],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train_test_gr_error</span>
</code></pre>
                </div>
              </div>

              <div>
                <style scoped="">
                  .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                  }

                  .dataframe tbody tr th {
                    vertical-align: top;
                  }

                  .dataframe thead th {
                    text-align: right;
                  }
                </style>
                <table border="1" class="dataframe">
                  <thead>
                    <tr style="text-align: right">
                      <th></th>
                      <th>train</th>
                      <th>test</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th>accuracy</th>
                      <td>0.529801</td>
                      <td>0.513216</td>
                    </tr>
                    <tr>
                      <th>precision</th>
                      <td>0.529801</td>
                      <td>0.513216</td>
                    </tr>
                    <tr>
                      <th>recall</th>
                      <td>1.000000</td>
                      <td>1.000000</td>
                    </tr>
                    <tr>
                      <th>f1</th>
                      <td>0.692641</td>
                      <td>0.678311</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">confusion_plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_gr</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>&lt;AxesSubplot:xlabel='Prediction', ylabel='True value'&gt;
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_65_1.png"
                  alt="png"
                />
              </p>

              <h3 id="3-3-classification-ensamble">
                3-3 Classification Ensamble
              </h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Estimate dtc model and report outcomes
</span><span class="n">gbc</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">n_iter_no_change</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">gbc</span><span class="p">,</span> <span class="n">rpt</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">gbc</span><span class="p">,</span> <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">prnt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="n">gbc2</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">n_iter_no_change</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span> <span class="n">gbc</span><span class="p">.</span><span class="n">n_estimators_</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'max_depth'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gbc</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
          <span class="s">'max_features'</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">gbc</span><span class="p">.</span><span class="n">max_features_</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">reg</span><span class="p">,</span> <span class="n">rpt</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">gbc2</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span> <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">cv_results_</span>
<span class="k">print</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_params_</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Fitting 5 folds for each of 2414 candidates, totalling 12070 fits
Best score: 0.6525073746312684
AxesSubplot(0.125,0.125;0.62x0.755)
Accuracy: 0.5903083700440529
F1: 0.541871921182266
{'max_depth': 3, 'max_features': 45}
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_67_1.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">model</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">best_estimator_</span>
<span class="n">feature_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'Date'</span><span class="p">,</span><span class="s">'daily_ret'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">columns</span><span class="p">).</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">feature_imp</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s">'Relative Importance'</span><span class="p">);</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s">'Feature'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_68_0.png"
                  alt="png"
                />
              </p>

              <h2 id="4-unsupervised">4. Unsupervised</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">aapl2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'./data/aapl2.csv'</span><span class="p">).</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1">## float_columns = [i for i in aapl2.columns if i not in ['Date']]
## no_cols = [i for i in aapl.columns if i not in float_columns]
## aapl2 = pd.merge(aapl[no_cols], aapl2, on='Date', how = 'left')
</span><span class="n">float_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aapl2</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">aapl2</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">]</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## sets backend to render higher res images
</span><span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="p">.</span><span class="n">figure_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s">'retina'</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span><span class="p">,</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span><span class="p">,</span> <span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">scale</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">AgglomerativeClustering</span>
</code></pre>
                </div>
              </div>

              <h3 id="4-1-k-means-clustering">4-1 K-means clustering</h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">sns</span><span class="p">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">"whitegrid"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">"talk"</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## helper function that allows us to display data in 2 dimensions an highlights the clusters
## def display_cluster(X,kmeans):
##     plt.scatter(X[:,0], 
##                 X[:,1])
</span>
<span class="c1">##     ## Plot the clusters 
##     plt.scatter(kmeans.cluster_centers_[:, 0], 
##                 kmeans.cluster_centers_[:, 1], 
##                 s=200,                             ## Set centroid size
##                 c='red')                           ## Set centroid color
##     plt.show()
</span><span class="k">def</span> <span class="nf">display_cluster</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">km</span><span class="o">=</span><span class="p">[],</span><span class="n">num_clusters</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">'brgcmyk'</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">if</span> <span class="n">num_clusters</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">):</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">km</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="n">km</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">km</span><span class="p">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">km</span><span class="p">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'x'</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">X_cdf</span> <span class="o">=</span> <span class="n">aapl2</span><span class="p">[[</span><span class="s">'Close_sp500'</span><span class="p">,</span> <span class="s">'Close_vix'</span><span class="p">]]</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">X_cdf</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">X_cdf</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">num_clusters</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1">## n_init, number of times the K-mean algorithm will run
</span><span class="n">km</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cdf</span><span class="p">)</span>
<span class="n">display_cluster</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="n">km</span><span class="p">,</span> <span class="n">num_clusters</span><span class="o">=</span><span class="n">num_clusters</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_76_0.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">inertia</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_num_clusters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>
<span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="n">list_num_clusters</span><span class="p">:</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">num_clusters</span><span class="p">)</span>
    <span class="n">km</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cdf</span><span class="p">)</span>
    <span class="n">inertia</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">km</span><span class="p">.</span><span class="n">inertia_</span><span class="p">)</span>
    
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">list_num_clusters</span><span class="p">,</span><span class="n">inertia</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">list_num_clusters</span><span class="p">,</span><span class="n">inertia</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Number of Clusters'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Inertia'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_77_0.png"
                  alt="png"
                />
              </p>

              <h3 id="4-2-comparing-in-multidimension">
                4-2 Comparing in multidimension
              </h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">km_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">]).</span><span class="n">transform</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">])</span>
<span class="k">for</span> <span class="n">clust</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">clust</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">km</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="n">km_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">({</span><span class="s">'clusters'</span><span class="p">:</span> <span class="n">clust</span><span class="p">,</span> 
                              <span class="s">'inertia'</span><span class="p">:</span> <span class="n">km</span><span class="p">.</span><span class="n">inertia_</span><span class="p">,</span>
                              <span class="s">'model'</span><span class="p">:</span> <span class="n">km</span><span class="p">}))</span>

<span class="n">plot_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">km_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">T</span>\
    <span class="p">[[</span><span class="s">'clusters'</span><span class="p">,</span><span class="s">'inertia'</span><span class="p">]].</span><span class="n">set_index</span><span class="p">(</span><span class="s">'clusters'</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">'-'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'Cluster'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">'Inertia'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>/Users/hun/miniforge3/envs/hun/lib/python3.9/site-packages/pandas/core/indexes/base.py:6982: FutureWarning: In a future version, the Index constructor will not infer numeric dtypes when passed object-dtype sequences (matching Series behavior)
  return Index(sequences[0], name=names)
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_79_1.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>
<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">res</span><span class="p">[</span><span class="s">'daily_ret'</span><span class="p">]</span> <span class="o">=</span> <span class="n">aapl2</span><span class="p">.</span><span class="n">daily_ret</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">]).</span><span class="n">transform</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">])</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">)</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">km</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s">'kmeans'</span><span class="p">]</span> <span class="o">=</span> <span class="n">km</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">ag</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s">'ward'</span><span class="p">,</span> <span class="n">compute_full_tree</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ag</span> <span class="o">=</span> <span class="n">ag</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s">'agglom'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ag</span><span class="p">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">res2</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="p">[[</span><span class="s">'daily_ret'</span><span class="p">,</span><span class="s">'agglom'</span><span class="p">,</span><span class="s">'kmeans'</span><span class="p">]]</span>
 <span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'daily_ret'</span><span class="p">,</span><span class="s">'agglom'</span><span class="p">,</span><span class="s">'kmeans'</span><span class="p">])</span>
 <span class="p">.</span><span class="n">size</span><span class="p">()</span>
 <span class="p">.</span><span class="n">to_frame</span><span class="p">()</span>
 <span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">'number'</span><span class="p">}))</span>
<span class="k">print</span><span class="p">(</span><span class="n">res2</span><span class="p">.</span><span class="n">to_latex</span><span class="p">())</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>\begin{tabular}{lllr}
\toprule
     &amp;   &amp;   &amp;  number \\
daily\_ret &amp; agglom &amp; kmeans &amp;         \\
\midrule
Bear &amp; 0 &amp; 0 &amp;     215 \\
     &amp;   &amp; 1 &amp;      43 \\
     &amp;   &amp; 2 &amp;       1 \\
     &amp;   &amp; 3 &amp;      22 \\
     &amp;   &amp; 4 &amp;       1 \\
     &amp; 1 &amp; 0 &amp;       6 \\
     &amp;   &amp; 2 &amp;       2 \\
     &amp;   &amp; 4 &amp;      18 \\
     &amp; 2 &amp; 0 &amp;       3 \\
     &amp;   &amp; 1 &amp;      88 \\
     &amp;   &amp; 2 &amp;       1 \\
     &amp;   &amp; 3 &amp;     266 \\
     &amp; 3 &amp; 2 &amp;     230 \\
     &amp;   &amp; 4 &amp;       4 \\
     &amp; 4 &amp; 0 &amp;       6 \\
     &amp;   &amp; 1 &amp;     163 \\
Bull &amp; 0 &amp; 0 &amp;     203 \\
     &amp;   &amp; 1 &amp;      40 \\
     &amp;   &amp; 3 &amp;      21 \\
     &amp;   &amp; 4 &amp;       1 \\
     &amp; 1 &amp; 0 &amp;       4 \\
     &amp;   &amp; 2 &amp;       1 \\
     &amp;   &amp; 4 &amp;      13 \\
     &amp; 2 &amp; 0 &amp;      13 \\
     &amp;   &amp; 1 &amp;     114 \\
     &amp;   &amp; 3 &amp;     339 \\
     &amp; 3 &amp; 0 &amp;       2 \\
     &amp;   &amp; 2 &amp;     266 \\
     &amp;   &amp; 4 &amp;       3 \\
     &amp; 4 &amp; 0 &amp;       8 \\
     &amp;   &amp; 1 &amp;     170 \\
\bottomrule
\end{tabular}



/var/folders/1t/_7p_zm4x449blqs7bvqvb0rm0000gn/T/ipykernel_66451/732263353.py:19: FutureWarning: In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
  print(res2.to_latex())
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## First, we import the cluster hierarchy module from SciPy (described above) to obtain the linkage and dendrogram functions.
</span><span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span>
<span class="c1">## Some color setup
</span><span class="n">red</span><span class="p">,</span><span class="n">blue</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">Z</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="p">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">ag</span><span class="p">.</span><span class="n">children_</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">'ward'</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">hierarchy</span><span class="p">.</span><span class="n">set_link_color_palette</span><span class="p">([</span><span class="n">red</span><span class="p">,</span> <span class="s">'gray'</span><span class="p">])</span>
<span class="n">den</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="p">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">'top'</span><span class="p">,</span> 
                           <span class="n">p</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">truncate_mode</span><span class="o">=</span><span class="s">'lastp'</span><span class="p">,</span>
                           <span class="n">show_leaf_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                           <span class="n">above_threshold_color</span><span class="o">=</span><span class="n">blue</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_81_0.png"
                  alt="png"
                />
              </p>

              <h3 id="4-3-utilizing-in-regression">
                4-3 utilizing in regression
              </h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">X_cdf</span> <span class="o">=</span> <span class="n">aapl2</span><span class="p">[[</span><span class="s">'Close_sp500'</span><span class="p">,</span> <span class="s">'Close_vix'</span><span class="p">,</span> <span class="s">'Close_bond_2y'</span><span class="p">]]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">X_cdf</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">X_cdf</span><span class="p">)</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">)</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">km</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">aapl</span><span class="p">[</span><span class="s">'kmeans'</span><span class="p">]</span> <span class="o">=</span> <span class="n">km</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">#### BEGIN SOLUTION
</span><span class="n">ag</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s">'ward'</span><span class="p">,</span> <span class="n">compute_full_tree</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ag</span> <span class="o">=</span> <span class="n">ag</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">aapl</span><span class="p">[</span><span class="s">'agglom'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ag</span><span class="p">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">one_hot_encode_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'kmeans'</span><span class="p">,</span><span class="s">'agglom'</span><span class="p">]</span>  <span class="c1">## list of categorical fields
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">aapl</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">one_hot_encode_cols</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">## Estimate dtc model and report outcomes
</span><span class="n">gbc</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">n_iter_no_change</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">gbc</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">gbc</span><span class="p">,</span> <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">prnt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="n">gbc2</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">n_iter_no_change</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span> <span class="n">gbc</span><span class="p">.</span><span class="n">n_estimators_</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'max_depth'</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gbc</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
          <span class="s">'max_features'</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">gbc</span><span class="p">.</span><span class="n">max_features_</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">learning</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">gbc2</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span> <span class="n">clss</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="n">cv_results_</span>
<span class="k">print</span><span class="p">(</span><span class="n">reg</span><span class="p">.</span><span class="n">best_params_</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>Fitting 5 folds for each of 1890 candidates, totalling 9450 fits
Best score: 0.5398230088495575
              precision    recall  f1-score   support

       False       0.51      0.52      0.51       106
        True       0.57      0.56      0.57       121

    accuracy                           0.54       227
   macro avg       0.54      0.54      0.54       227
weighted avg       0.54      0.54      0.54       227

Accuracy: 0.5418502202643172
F1: 0.5666666666666667
AxesSubplot(0.125,0.125;0.62x0.755)
{'max_depth': 17, 'max_features': 17}
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_84_1.png"
                  alt="png"
                />
              </p>

              <h3 id="4-4-pca">4-4 PCA</h3>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">feature_weight_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="c1">## Fit a range of PCA models
</span><span class="n">data</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">]).</span><span class="n">transform</span><span class="p">(</span><span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">])</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    
    <span class="c1">## Create and fit the model
</span>    <span class="n">PCAmod</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">PCAmod</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1">## Store the model and variance
</span>    <span class="n">pca_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">({</span><span class="s">'n'</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="s">'model'</span><span class="p">:</span><span class="n">PCAmod</span><span class="p">,</span>
                               <span class="s">'var'</span><span class="p">:</span> <span class="n">PCAmod</span><span class="p">.</span><span class="n">explained_variance_ratio_</span><span class="p">.</span><span class="nb">sum</span><span class="p">()}))</span>
    
    <span class="c1">## Calculate and store feature importances
</span>    <span class="n">abs_feature_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PCAmod</span><span class="p">.</span><span class="n">components_</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">feature_weight_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'n'</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> 
                                             <span class="s">'features'</span><span class="p">:</span> <span class="n">float_columns</span><span class="p">,</span>
                                             <span class="s">'values'</span><span class="p">:</span><span class="n">abs_feature_values</span><span class="o">/</span><span class="n">abs_feature_values</span><span class="p">.</span><span class="nb">sum</span><span class="p">()}))</span>
    
<span class="n">pca_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pca_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">T</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'n'</span><span class="p">)</span>
<span class="n">features_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feature_weight_list</span><span class="p">)</span>
               <span class="p">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s">'n'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'features'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">'values'</span><span class="p">))</span>

<span class="n">features_df</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>/Users/hun/miniforge3/envs/hun/lib/python3.9/site-packages/pandas/core/indexes/base.py:6982: FutureWarning: In a future version, the Index constructor will not infer numeric dtypes when passed object-dtype sequences (matching Series behavior)
  return Index(sequences[0], name=names)
</code></pre>
                </div>
              </div>

              <div>
                <style scoped="">
                  .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                  }

                  .dataframe tbody tr th {
                    vertical-align: top;
                  }

                  .dataframe thead th {
                    text-align: right;
                  }
                </style>
                <table border="1" class="dataframe">
                  <thead>
                    <tr style="text-align: right">
                      <th>features</th>
                      <th>AAPL_factor1</th>
                      <th>AAPL_factor2</th>
                      <th>CO</th>
                      <th>Close</th>
                      <th>Close_bond_10y</th>
                      <th>Close_bond_1m</th>
                      <th>Close_bond_1y</th>
                      <th>Close_bond_2y</th>
                      <th>Close_itw</th>
                      <th>Close_nasdaq</th>
                      <th>...</th>
                      <th>ma120</th>
                      <th>ma20</th>
                      <th>std120</th>
                      <th>std20</th>
                      <th>std_high20</th>
                      <th>std_intra</th>
                      <th>std_open20</th>
                      <th>support_high</th>
                      <th>support_low</th>
                      <th>support_open</th>
                    </tr>
                    <tr>
                      <th>n</th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th>6</th>
                      <td>0.030236</td>
                      <td>0.037193</td>
                      <td>0.008199</td>
                      <td>0.027970</td>
                      <td>0.032612</td>
                      <td>0.032992</td>
                      <td>0.033682</td>
                      <td>0.034586</td>
                      <td>0.026851</td>
                      <td>0.027899</td>
                      <td>...</td>
                      <td>0.032207</td>
                      <td>0.030129</td>
                      <td>0.018837</td>
                      <td>0.018717</td>
                      <td>0.018823</td>
                      <td>0.016651</td>
                      <td>0.019013</td>
                      <td>0.034963</td>
                      <td>0.035248</td>
                      <td>0.037478</td>
                    </tr>
                    <tr>
                      <th>7</th>
                      <td>0.032490</td>
                      <td>0.032149</td>
                      <td>0.010461</td>
                      <td>0.025679</td>
                      <td>0.029585</td>
                      <td>0.028476</td>
                      <td>0.028742</td>
                      <td>0.029950</td>
                      <td>0.026914</td>
                      <td>0.027032</td>
                      <td>...</td>
                      <td>0.028294</td>
                      <td>0.029327</td>
                      <td>0.019782</td>
                      <td>0.021357</td>
                      <td>0.021676</td>
                      <td>0.026183</td>
                      <td>0.021668</td>
                      <td>0.032671</td>
                      <td>0.031947</td>
                      <td>0.034375</td>
                    </tr>
                    <tr>
                      <th>8</th>
                      <td>0.036669</td>
                      <td>0.028255</td>
                      <td>0.012337</td>
                      <td>0.022213</td>
                      <td>0.029923</td>
                      <td>0.028524</td>
                      <td>0.029117</td>
                      <td>0.030328</td>
                      <td>0.025168</td>
                      <td>0.023790</td>
                      <td>...</td>
                      <td>0.031052</td>
                      <td>0.026635</td>
                      <td>0.018100</td>
                      <td>0.022617</td>
                      <td>0.022573</td>
                      <td>0.024953</td>
                      <td>0.022605</td>
                      <td>0.030334</td>
                      <td>0.029549</td>
                      <td>0.031957</td>
                    </tr>
                    <tr>
                      <th>9</th>
                      <td>0.037665</td>
                      <td>0.028583</td>
                      <td>0.028795</td>
                      <td>0.021349</td>
                      <td>0.029740</td>
                      <td>0.027302</td>
                      <td>0.028086</td>
                      <td>0.029355</td>
                      <td>0.023119</td>
                      <td>0.022945</td>
                      <td>...</td>
                      <td>0.033827</td>
                      <td>0.024899</td>
                      <td>0.017160</td>
                      <td>0.021789</td>
                      <td>0.021669</td>
                      <td>0.024982</td>
                      <td>0.021553</td>
                      <td>0.029501</td>
                      <td>0.029063</td>
                      <td>0.031652</td>
                    </tr>
                  </tbody>
                </table>
                <p>4 rows Ã— 35 columns</p>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">sns</span><span class="p">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">'talk'</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pca_df</span><span class="p">[</span><span class="s">'var'</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'Number of dimensions'</span><span class="p">,</span>
       <span class="n">ylabel</span><span class="o">=</span><span class="s">'Percent explained variance'</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">'Explained Variance vs Dimensions'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_87_0.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">ax</span> <span class="o">=</span> <span class="n">features_df</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'upper right'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'Number of dimensions'</span><span class="p">,</span>
       <span class="n">ylabel</span><span class="o">=</span><span class="s">'Relative importance'</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">'Feature importance vs Dimensions'</span><span class="p">);</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_88_0.png"
                  alt="png"
                />
              </p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">KernelPCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1">## Custom scorer--use negative rmse of inverse transform
</span><span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="n">pcamodel</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">values</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span>
        
    <span class="c1">## Calculate and inverse transform the data
</span>    <span class="n">data_inv</span> <span class="o">=</span> <span class="n">pcamodel</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_val</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
    <span class="n">data_inv</span> <span class="o">=</span> <span class="n">pcamodel</span><span class="p">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data_inv</span><span class="p">)</span>
    
    <span class="c1">## The error calculation
</span>    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">data_inv</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">X_val</span><span class="p">.</span><span class="n">ravel</span><span class="p">())</span>
    
    <span class="c1">## Larger values are better for scorers, so take negative value
</span>    <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">mse</span>

<span class="c1">## The grid search parameters
</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s">'gamma'</span><span class="p">:[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
              <span class="s">'n_components'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>

<span class="c1">## The grid search
</span><span class="n">kernelPCA</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">KernelPCA</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'rbf'</span><span class="p">,</span> <span class="n">fit_inverse_transform</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                         <span class="n">scoring</span><span class="o">=</span><span class="n">scorer</span><span class="p">,</span>
                         <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>


<span class="n">kernelPCA</span> <span class="o">=</span> <span class="n">kernelPCA</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">kernelPCA</span><span class="p">.</span><span class="n">best_estimator_</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>KernelPCA(fit_inverse_transform=True, gamma=0.05, kernel='rbf', n_components=4)
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">kernelPCA</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">.</span><span class="n">eigenvalues_</span>
</code></pre>
                </div>
              </div>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code>array([163.71226988, 144.0926473 ,  93.50586323,  65.88489674])
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>


<span class="n">X</span> <span class="o">=</span> <span class="n">aapl2</span><span class="p">[</span><span class="n">float_columns</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">aapl2</span><span class="p">.</span><span class="n">daily_ret</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_avg_score</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'scaler'</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="p">(</span><span class="s">'pca'</span><span class="p">,</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n</span><span class="p">)),</span>
        <span class="p">(</span><span class="s">'estimator'</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">'liblinear'</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">sss</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">X</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">y</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
        <span class="n">pipe</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pipe</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>


<span class="n">ns</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">score_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_avg_score</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">]</span>
</code></pre>
                </div>
              </div>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="n">sns</span><span class="p">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">'talk'</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">score_list</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'Number of Dimensions'</span><span class="p">,</span>
       <span class="n">ylabel</span><span class="o">=</span><span class="s">'Average Accuracy'</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">'LogisticRegression Accuracy vs Number of dimensions on the Human Activity Dataset'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</code></pre>
                </div>
              </div>

              <p>
                <img
                  src="/assets/images/ibm_assignment_files/ibm_assignment_92_0.png"
                  alt="png"
                />
              </p>

              <h2 id="etc">ETC</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"
                  ><code><span class="c1">### How to make pipeline by features?
</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_union</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="k">def</span> <span class="nf">get_text_cols</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'fruit'</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">get_num_cols</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="s">'height'</span><span class="p">,</span><span class="s">'age'</span><span class="p">]]</span>

<span class="n">vec</span> <span class="o">=</span> <span class="n">make_union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
    <span class="n">make_pipeline</span><span class="p">(</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">get_text_cols</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">LabelEncoder</span><span class="p">()))),</span>
    <span class="n">make_pipeline</span><span class="p">(</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">get_num_cols</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">MinMaxScaler</span><span class="p">())))</span>
<span class="p">])</span>

</code></pre>
                </div>
              </div>
            </section>

            <footer class="page__meta"></footer>

            <section class="page__share">
              <h4 class="page__share-title">Share on</h4>

              <a
                href="https://twitter.com/intent/tweet?text=Machine+Learning+on+Apple+stock+daily+return2%20https%3A%2F%2Fleeway00.github.io%2Fibm%2Fproj2%2F"
                class="btn btn--twitter"
                onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
                title="Share on Twitter"
                ><i class="fab fa-fw fa-twitter" aria-hidden="true"></i
                ><span> Twitter</span></a
              >

              <a
                href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fleeway00.github.io%2Fibm%2Fproj2%2F"
                class="btn btn--facebook"
                onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
                title="Share on Facebook"
                ><i class="fab fa-fw fa-facebook" aria-hidden="true"></i
                ><span> Facebook</span></a
              >

              <a
                href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fleeway00.github.io%2Fibm%2Fproj2%2F"
                class="btn btn--linkedin"
                onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
                title="Share on LinkedIn"
                ><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i
                ><span> LinkedIn</span></a
              >
            </section>

            <nav class="pagination">
              <a
                href="/ibm/proj1/"
                class="pagination--pager"
                title="Machine Learning on Apple stock daily return
"
                >Previous</a
              >

              <a
                href="/rl/policy2/"
                class="pagination--pager"
                title="Policy Gradient Method
"
                >Next</a
              >
            </nav>
          </div>

          <div class="page__comments">
            <h4 class="page__comments-title">Leave a comment</h4>
            <section
              class="fb-comments"
              data-href="https://leeway00.github.io/ibm/proj2/"
              data-mobile="true"
              data-num-posts="5"
              data-width="100%"
              data-colorscheme="light"
            ></section>
          </div>
        </article>

        <div class="page__related">
          <h2 class="page__related-title">You may also enjoy</h2>
          <div class="grid__wrapper">
            <div class="grid__item">
              <article
                class="archive__item"
                itemscope
                itemtype="https://schema.org/CreativeWork"
              >
                <h2 class="archive__item-title no_toc" itemprop="headline">
                  <a href="/rl/policy2/" rel="permalink"
                    >Policy Gradient Method
                  </a>
                </h2>

                <p class="page__meta">
                  <span class="page__meta-readtime">
                    <i class="far fa-clock" aria-hidden="true"></i>

                    less than 1 minute read
                  </span>
                </p>

                <p class="archive__item-excerpt" itemprop="description">
                  Policy Gradient Method
                </p>
              </article>
            </div>

            <div class="grid__item">
              <article
                class="archive__item"
                itemscope
                itemtype="https://schema.org/CreativeWork"
              >
                <h2 class="archive__item-title no_toc" itemprop="headline">
                  <a href="/ibm/proj1/" rel="permalink"
                    >Machine Learning on Apple stock daily return
                  </a>
                </h2>

                <p class="page__meta">
                  <span class="page__meta-readtime">
                    <i class="far fa-clock" aria-hidden="true"></i>

                    19 minute read
                  </span>
                </p>

                <p class="archive__item-excerpt" itemprop="description">
                  import numpy as np import pandas as pd import os import
                  matplotlib.pyplot as plt %matplotlib inline import seaborn as
                  sns
                </p>
              </article>
            </div>

            <div class="grid__item">
              <article
                class="archive__item"
                itemscope
                itemtype="https://schema.org/CreativeWork"
              >
                <h2 class="archive__item-title no_toc" itemprop="headline">
                  <a href="/ibm/dl6/" rel="permalink"
                    >Reinforcement Learning
                  </a>
                </h2>

                <p class="page__meta">
                  <span class="page__meta-readtime">
                    <i class="far fa-clock" aria-hidden="true"></i>

                    less than 1 minute read
                  </span>
                </p>

                <p class="archive__item-excerpt" itemprop="description">
                  Reinforcement Learning Agents interact with an Environment
                  Choose from a set of available actions Actions impact the
                  environment, which impacts agents...
                </p>
              </article>
            </div>

            <div class="grid__item">
              <article
                class="archive__item"
                itemscope
                itemtype="https://schema.org/CreativeWork"
              >
                <h2 class="archive__item-title no_toc" itemprop="headline">
                  <a href="/ibm/dl5/" rel="permalink">Autoencoder and GAN </a>
                </h2>

                <p class="page__meta">
                  <span class="page__meta-readtime">
                    <i class="far fa-clock" aria-hidden="true"></i>

                    1 minute read
                  </span>
                </p>

                <p class="archive__item-excerpt" itemprop="description">
                  Autoencoder Several applications: Dimensional reduction
                  Preprocessing for classification Identifying essential
                  elements of the input data and filterin...
                </p>
              </article>
            </div>
          </div>
        </div>
      </div>

      <!-- <script>
    var elements = document.querySelectorAll('.page__content.e-content').childNodes; // ìˆ˜ì •1 
    var addContent = false;
    var contentsToAdd = [];
    var expandtags = null;
    var detailText = null;
    var detailsTag = null;
    var summaryTag = null;
    var detailsContent = null;
    for (var i=elements.length - 1; i > -1; i--){
        el = elements[i]
        if (el.innerHTML == '[/expand]'){
            addContent = true
            detailsContent = document.createElement('div')
            detailsContent.className = 'collaspe-content'
            detailsContent.setAttribute('markdown', '1')
            el.parentNode.removeChild(el)
        } else if (el.innerHTML == '[expand]' || (el.nodeName == 'P' && el.innerHTML.includes('[expand]summary:'))) {
            addContent = false
            expandtags = el.innerHTML.split('summary:')
            if (expandtags.length == 1){
                detailText = 'Details'
            } else {
                detailText = expandtags[1]
            }
            detailsTag = document.createElement('details')
            detailsTag.className = 'collaspe-article'
            summaryTag = document.createElement('summary')
            summaryTag.appendChild(document.createTextNode(detailText))
            detailsTag.appendChild(summaryTag)
            for (var j=contentsToAdd.length - 1; j > -1; j--) {
                detailsContent.appendChild(contentsToAdd[j])
            }
            detailsTag.appendChild(detailsContent)
            el.parentNode.replaceChild(detailsTag, el)
            contentsToAdd = []
        } else {
            if (addContent) {
                contentsToAdd.push(el)
            }
        }
    }
</script> -->
    </div>

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

        <!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div> -->

        <div class="page__footer-copyright">
          &copy; 2022 Younghun Lee. Powered by
          <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp;
          <a
            href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/"
            rel="nofollow"
            >Minimal Mistakes</a
          >.
        </div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>

    <div id="fb-root"></div>
    <script>
      (function (d, s, id) {
        var js,
          fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
        fjs.parentNode.insertBefore(js, fjs);
      })(document, "script", "facebook-jssdk");
    </script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
      integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
      integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
      integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
      crossorigin="anonymous"
      onload="renderMathInElement(document.body);"
    ></script>
  </body>
</html>
